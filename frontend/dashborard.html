<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Echo Track Schoolcore is a smart web platform for managing school waste, resources, and unused spaces to create a cleaner and more sustainable learning environment.">
    <title>Dashboard | Echo Track Schoolcore</title>
    
    <link rel="stylesheet" href="css/common.css">
    <link rel="icon" type="image/png" href="images/web logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 100px;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .dashboard-header h1 {
            color: #114814;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .dashboard-header p {
            color: #666;
            font-size: 16px;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #21a300;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #666;
            font-size: 14px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .tab-button:hover {
            background: rgba(33, 163, 0, 0.1);
        }

        .tab-button.active {
            background: #21a300;
            color: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Entries Grid */
        .entries-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .entries-grid {
            display: grid;
            gap: 20px;
        }

        .entry-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #21a300;
            transition: transform 0.2s ease;
        }

        .entry-card:hover {
            transform: translateX(5px);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ddd;
        }

        .entry-title {
            font-weight: 600;
            color: #114814;
            font-size: 16px;
        }

        .entry-date {
            color: #666;
            font-size: 14px;
        }

        .entry-details {
            display: grid;
            gap: 10px;
        }

        .entry-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .entry-detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #666;
            font-weight: 500;
            font-size: 14px;
        }

        .detail-value {
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        /* ‚úÖ NEW: Photo Gallery Styles */
        .photo-gallery {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #eee;
        }

        .gallery-title {
            color: #666;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .photo-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid #21a300;
            transition: all 0.3s ease;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-thumbnail:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(33, 163, 0, 0.3);
        }

        .photo-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-placeholder {
            color: #999;
            font-size: 12px;
            text-align: center;
            padding: 5px;
        }

        /* ‚úÖ NEW: Modal/Lightbox Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90vh;
            overflow: auto;
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .modal-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .modal-info {
            color: #666;
            font-size: 14px;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            background: #f0f0f0;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #21a300;
            color: white;
        }

        .modal-nav {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-nav button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #21a300;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-nav button:hover {
            background: #1a8000;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 16px;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-data-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .no-data h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .no-data p {
            color: #999;
        }

        .refresh-btn {
            background: #21a300;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #1a8000;
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 10px;
                padding-top: 80px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-button {
                width: 100%;
            }

            .entry-detail-row {
                flex-direction: column;
                gap: 5px;
            }

            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }

            .photo-thumbnail {
                width: 60px;
                height: 60px;
            }

            .modal-content {
                max-width: 95%;
                padding: 15px;
            }

            .modal-image {
                max-height: 60vh;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <div class="logo-section">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/web logo.png" alt="Logo Echo Track">
                    </a>
                </div>
            </div>

            <div class="nav-center">
                <ul class="nav-links">
                    <li><a href="profile.html">Home</a></li>
                    <li><a href="dashboard-updated.html" class="active">Dashboard</a></li>
                </ul>
            </div>

            <div class="nav-buttons">
                <button onclick="logout()" class="btn btn-primary">Logout</button>
            </div>
        </div>
    </nav>

    <main class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <h1>üìä Management Dashboard</h1>
            <p>View and monitor all submitted data</p>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon">üóëÔ∏è</div>
                <div class="number" id="totalWaste">0</div>
                <div class="label">Daily Waste Entries</div>
            </div>
            <div class="stat-card">
                <div class="icon">üìä</div>
                <div class="number" id="totalResources">0</div>
                <div class="label">Weekly Resource Entries</div>
            </div>
            <div class="stat-card">
                <div class="icon">üè¢</div>
                <div class="number" id="totalSpaces">0</div>
                <div class="label">Unused Space Reports</div>
            </div>
            <div class="stat-card">
                <div class="icon">üë•</div>
                <div class="number" id="totalUsers">0</div>
                <div class="label">Total Users</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('waste', event)">
                üóëÔ∏è Daily Waste
            </button>
            <button class="tab-button" onclick="switchTab('resources', event)">
                üìä Weekly Resources
            </button>
            <button class="tab-button" onclick="switchTab('spaces', event)">
                üè¢ Unused Spaces
            </button>
        </div>

        <!-- Tab Contents -->
        
        <!-- Daily Waste Tab -->
        <div id="waste-tab" class="tab-content active">
            <div class="entries-container">
                <button class="refresh-btn" onclick="loadWasteEntries()">üîÑ Refresh Data</button>
                <div id="wasteEntriesContainer" class="loading">Loading waste entries...</div>
            </div>
        </div>

        <!-- Weekly Resources Tab -->
        <div id="resources-tab" class="tab-content">
            <div class="entries-container">
                <div style="margin-bottom: 15px;">
                    <button class="refresh-btn" onclick="loadResourceEntries()" style="margin-right: 10px;">
                        üîÑ Refresh Data
                    </button>
                    <button class="refresh-btn" onclick="testResourcesLoad()" style="background: #ff9800;">
                        üß™ Test Load Function
                    </button>
                </div>
                <div id="resourceEntriesContainer" class="loading">Loading resource entries...</div>
            </div>
        </div>

        <!-- Unused Spaces Tab -->
        <div id="spaces-tab" class="tab-content">
            <div class="entries-container">
                <button class="refresh-btn" onclick="loadSpaceEntries()">üîÑ Refresh Data</button>
                <div id="spaceEntriesContainer" class="loading">Loading space entries...</div>
            </div>
        </div>
    </main>

    <!-- ‚úÖ NEW: Photo Lightbox Modal -->
    <div id="photoModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePhotoModal()">&times;</button>
            <div id="photoModalImage"></div>
            <div id="photoModalInfo" class="modal-info"></div>
            <div class="modal-nav">
                <button onclick="previousPhoto()" id="prevBtn">‚Üê Previous</button>
                <button onclick="nextPhoto()" id="nextBtn">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-text">
                &copy; 2025 Echo Track SchoolCore. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/custom-cursor.js" defer></script>
    <script>
        // ‚úÖ NEW: Photo Modal Variables
        let currentPhotos = [];
        let currentPhotoIndex = 0;

        // Check authentication
        if (!isAuthenticated()) {
            console.log('‚ùå Not authenticated, redirecting to login...');
            window.location.href = 'login.html';
        }

        // Check authorization
        async function checkAuthorization() {
            return new Promise((resolve, reject) => {
                try {
                    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                    console.log('üë§ User role:', userData.role);
                    
                    const allowedRoles = [
                        'Principal',
                        'Management Staff',
                        'Deputy Principal',
                        'Assistant Principal',
                        'Section Head'
                    ];
                    
                    if (!allowedRoles.includes(userData.role)) {
                        console.log('‚ùå Access denied for role:', userData.role);
                        alert('Access denied. This dashboard is only for management staff.');
                        window.location.href = 'profile.html';
                        reject(new Error('Unauthorized role'));
                        return;
                    }
                    
                    console.log('‚úÖ Authorization passed');
                    resolve(true);
                } catch (error) {
                    console.error('‚ùå Authorization check error:', error);
                    window.location.href = 'login.html';
                    reject(error);
                }
            });
        }

        // Tab switching - FIXED: Properly loads data when switching tabs
        function switchTab(tabName, event) {
            console.log('üîÑ Switching to tab:', tabName);
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // ‚úÖ FIX: Load data for the selected tab
            console.log('üìä Loading data for tab:', tabName);
            if (tabName === 'waste') {
                loadWasteEntries();
            } else if (tabName === 'resources') {
                loadResourceEntries();
            } else if (tabName === 'spaces') {
                loadSpaceEntries();
            }
        }

        // Load Dashboard Statistics
        async function loadStatistics() {
            try {
                console.log('üìä Loading statistics...');
                const data = await apiCall(API_CONFIG.ENDPOINTS.DASHBOARD_STATS);
                
                if (data.success && data.stats) {
                    document.getElementById('totalWaste').textContent = data.stats.totalWasteEntries || 0;
                    document.getElementById('totalResources').textContent = data.stats.totalResourceEntries || 0;
                    document.getElementById('totalSpaces').textContent = data.stats.totalSpaceEntries || 0;
                    document.getElementById('totalUsers').textContent = data.stats.totalUsers || 0;
                }
            } catch (error) {
                console.error('‚ùå Error loading statistics:', error);
            }
        }

        // Load Daily Waste Entries
        async function loadWasteEntries() {
            const container = document.getElementById('wasteEntriesContainer');
            container.innerHTML = '<div class="loading">Loading waste entries...</div>';

            try {
                const response = await apiCall('/api/waste/daily');
                
                if (response.success && response.entries && response.entries.length > 0) {
                    container.innerHTML = '<div class="entries-grid"></div>';
                    const grid = container.querySelector('.entries-grid');
                    
                    response.entries.forEach((entry) => {
                        const card = createWasteCard(entry);
                        grid.appendChild(card);
                    });
                } else {
                    container.innerHTML = `
                        <div class="no-data">
                            <div class="no-data-icon">üóëÔ∏è</div>
                            <h3>No Waste Entries Found</h3>
                            <p>No daily waste data has been submitted yet.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error loading waste entries:', error);
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">‚ùå</div>
                        <h3>Failed to Load Waste Entries</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Load Weekly Resource Entries - FIXED WITH DETAILED LOGGING
        async function loadResourceEntries() {
            console.log('üîç loadResourceEntries() called');
            const container = document.getElementById('resourceEntriesContainer');
            
            if (!container) {
                console.error('‚ùå Container #resourceEntriesContainer not found!');
                return;
            }
            
            console.log('‚úÖ Container found:', container);
            container.innerHTML = '<div class="loading">Loading resource entries...</div>';

            try {
                console.log('üì° Calling API: /api/resources/weekly');
                const response = await apiCall('/api/resources/weekly');
                
                console.log('üì¶ API Response received:', response);
                console.log('  - success:', response.success);
                console.log('  - entries:', response.entries);
                console.log('  - entries length:', response.entries?.length);
                
                if (response.success && response.entries && response.entries.length > 0) {
                    console.log(`‚úÖ Rendering ${response.entries.length} resource entries`);
                    container.innerHTML = '<div class="entries-grid"></div>';
                    const grid = container.querySelector('.entries-grid');
                    
                    if (!grid) {
                        console.error('‚ùå Grid element not created!');
                        return;
                    }
                    
                    response.entries.forEach((entry, index) => {
                        console.log(`  Creating card ${index + 1}:`, entry.submittedByName);
                        const card = createResourceCard(entry);
                        grid.appendChild(card);
                    });
                    
                    console.log('‚úÖ All resource cards appended to grid');
                } else {
                    console.warn('‚ö†Ô∏è No entries to display');
                    console.warn('  Response:', response);
                    container.innerHTML = `
                        <div class="no-data">
                            <div class="no-data-icon">üìä</div>
                            <h3>No Resource Entries Found</h3>
                            <p>No weekly resource data has been submitted yet.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error loading resource entries:', error);
                console.error('‚ùå Error stack:', error.stack);
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">‚ùå</div>
                        <h3>Failed to Load Resource Entries</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Test function to verify resources load
        async function testResourcesLoad() {
            console.log('üß™ TEST: Manual load test started');
            console.log('üß™ TEST: Checking if function exists:', typeof loadResourceEntries);
            console.log('üß™ TEST: Checking container exists:', !!document.getElementById('resourceEntriesContainer'));
            
            alert('Check console for detailed logs. About to call loadResourceEntries()...');
            
            try {
                await loadResourceEntries();
                alert('‚úÖ Load completed! Check console for details.');
            } catch (error) {
                alert('‚ùå Load failed: ' + error.message);
                console.error('üß™ TEST ERROR:', error);
            }
        }

        // Load Unused Space Entries
        async function loadSpaceEntries() {
            const container = document.getElementById('spaceEntriesContainer');
            container.innerHTML = '<div class="loading">Loading space entries...</div>';

            try {
                const response = await apiCall('/api/spaces/unused');
                
                if (response.success && response.entries && response.entries.length > 0) {
                    container.innerHTML = '<div class="entries-grid"></div>';
                    const grid = container.querySelector('.entries-grid');
                    
                    response.entries.forEach((entry) => {
                        const card = createSpaceCard(entry);
                        grid.appendChild(card);
                    });
                } else {
                    container.innerHTML = `
                        <div class="no-data">
                            <div class="no-data-icon">üè¢</div>
                            <h3>No Space Reports Found</h3>
                            <p>No unused space reports have been submitted yet.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('‚ùå Error loading space entries:', error);
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">‚ùå</div>
                        <h3>Failed to Load Space Entries</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // ‚úÖ NEW: Photo Display Functionality
        function displayPhotos(photos, entryTitle) {
            if (!photos || photos.length === 0) {
                return '<div class="photo-placeholder">No photos</div>';
            }

            let html = `<div class="photo-gallery">
                <div class="gallery-title">üì∑ Photos (${photos.length})</div>
                <div class="photo-grid">`;

            photos.forEach((photo, index) => {
                // Handle both Base64 and Cloudinary formats
                let photoSrc = '';
                
                if (photo.data) {
                    // Base64 format
                    photoSrc = photo.data.startsWith('data:') 
                        ? photo.data 
                        : `data:${photo.mimeType || 'image/jpeg'};base64,${photo.data}`;
                } else if (photo.url) {
                    // Cloudinary format
                    photoSrc = photo.url;
                }

                html += `<div class="photo-thumbnail" onclick="openPhotoModal(${JSON.stringify(photos).replace(/"/g, '&quot;')}, ${index}, '${entryTitle}')">
                    <img src="${photoSrc}" alt="Photo ${index + 1}" onerror="this.parentElement.innerHTML='<div class=&quot;photo-placeholder&quot;>Failed to load</div>'">
                </div>`;
            });

            html += '</div></div>';
            return html;
        }

        // ‚úÖ NEW: Photo Modal Functions
        function openPhotoModal(photos, index, title) {
            currentPhotos = photos;
            currentPhotoIndex = index;
            showPhotoModal(title);
        }

        function showPhotoModal(title) {
            const modal = document.getElementById('photoModal');
            const photo = currentPhotos[currentPhotoIndex];
            
            let photoSrc = '';
            if (photo.data) {
                photoSrc = photo.data.startsWith('data:') 
                    ? photo.data 
                    : `data:${photo.mimeType || 'image/jpeg'};base64,${photo.data}`;
            } else if (photo.url) {
                photoSrc = photo.url;
            }

            const imageHtml = `<img src="${photoSrc}" class="modal-image" alt="Photo">`;
            const infoHtml = `<p>${title} - Photo ${currentPhotoIndex + 1} of ${currentPhotos.length}</p>`;
            
            document.getElementById('photoModalImage').innerHTML = imageHtml;
            document.getElementById('photoModalInfo').innerHTML = infoHtml;
            
            // Update button states
            document.getElementById('prevBtn').disabled = currentPhotoIndex === 0;
            document.getElementById('nextBtn').disabled = currentPhotoIndex === currentPhotos.length - 1;
            
            modal.classList.add('active');
        }

        function closePhotoModal() {
            document.getElementById('photoModal').classList.remove('active');
        }

        function previousPhoto() {
            if (currentPhotoIndex > 0) {
                currentPhotoIndex--;
                showPhotoModal('Photo');
            }
        }

        function nextPhoto() {
            if (currentPhotoIndex < currentPhotos.length - 1) {
                currentPhotoIndex++;
                showPhotoModal('Photo');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('photoModal');
            if (event.target === modal) {
                closePhotoModal();
            }
        });

        // Create Waste Entry Card
        function createWasteCard(entry) {
            const card = document.createElement('div');
            card.className = 'entry-card';
            
            const date = entry.date ? new Date(entry.date).toLocaleDateString() : 'N/A';
            
            card.innerHTML = `
                <div class="entry-header">
                    <span class="entry-title">üóëÔ∏è ${entry.submittedByName || 'Unknown'}</span>
                    <span class="entry-date">${date}</span>
                </div>
                <div class="entry-details">
                    <div class="entry-detail-row">
                        <span class="detail-label">Section/Grade:</span>
                        <span class="detail-value">${entry.submittedSection || 'N/A'} ${entry.submittedGrade || ''}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Paper Waste:</span>
                        <span class="detail-value">${entry.paperWaste || 0} kg</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Plastic Waste:</span>
                        <span class="detail-value">${entry.plasticWaste || 0} kg</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Food Waste:</span>
                        <span class="detail-value">${entry.foodWaste || 0} kg</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">General Waste:</span>
                        <span class="detail-value">${entry.generalWaste || 0} kg</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Properly Segregated:</span>
                        <span class="detail-value">${entry.wasProperlySegregated ? '‚úÖ Yes' : '‚ùå No'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Cleanliness:</span>
                        <span class="detail-value">${entry.classroomCleanliness || 'N/A'}</span>
                    </div>
                    ${entry.additionalNotes ? `
                        <div class="entry-detail-row">
                            <span class="detail-label">Notes:</span>
                            <span class="detail-value">${entry.additionalNotes}</span>
                        </div>
                    ` : ''}
                </div>
                ${displayPhotos(entry.photos, `Daily Waste - ${entry.submittedByName}`)}
            `;
            
            return card;
        }

        // Create Resource Entry Card
        function createResourceCard(entry) {
            const card = document.createElement('div');
            card.className = 'entry-card';
            
            const date = entry.weekEnding ? new Date(entry.weekEnding).toLocaleDateString() : 'N/A';
            
            card.innerHTML = `
                <div class="entry-header">
                    <span class="entry-title">üìä ${entry.submittedByName || 'Unknown'}</span>
                    <span class="entry-date">Week Ending: ${date}</span>
                </div>
                <div class="entry-details">
                    <div class="entry-detail-row">
                        <span class="detail-label">Location:</span>
                        <span class="detail-value">${entry.location || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Specific Area:</span>
                        <span class="detail-value">${entry.specificArea || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Furniture Items:</span>
                        <span class="detail-value">${entry.furniture?.length || 0} items</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Equipment Items:</span>
                        <span class="detail-value">${entry.equipment?.length || 0} items</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Overall Condition:</span>
                        <span class="detail-value">${entry.overallCondition || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Space Utilization:</span>
                        <span class="detail-value">${entry.spaceUtilization || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Priority Level:</span>
                        <span class="detail-value">${entry.priorityLevel || 'N/A'}</span>
                    </div>
                    ${entry.notes ? `
                        <div class="entry-detail-row">
                            <span class="detail-label">Notes:</span>
                            <span class="detail-value">${entry.notes}</span>
                        </div>
                    ` : ''}
                </div>
                ${displayPhotos(entry.photos, `Weekly Resources - ${entry.submittedByName}`)}
            `;
            
            return card;
        }

        // Create Space Entry Card
        function createSpaceCard(entry) {
            const card = document.createElement('div');
            card.className = 'entry-card';
            
            const date = entry.createdAt ? new Date(entry.createdAt).toLocaleDateString() : 'N/A';
            
            card.innerHTML = `
                <div class="entry-header">
                    <span class="entry-title">üè¢ ${entry.submittedByName || 'Unknown'}</span>
                    <span class="entry-date">${date}</span>
                </div>
                <div class="entry-details">
                    <div class="entry-detail-row">
                        <span class="detail-label">Building:</span>
                        <span class="detail-value">${entry.buildingName || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Floor:</span>
                        <span class="detail-value">${entry.floorNumber || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Room Number:</span>
                        <span class="detail-value">${entry.roomNumber || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Near Location:</span>
                        <span class="detail-value">${entry.nearLocation || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Space Type:</span>
                        <span class="detail-value">${entry.spaceType || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Space Size:</span>
                        <span class="detail-value">${entry.spaceSize || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Condition:</span>
                        <span class="detail-value">${entry.spaceCondition || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Priority:</span>
                        <span class="detail-value">${entry.priority || 'N/A'}</span>
                    </div>
                    <div class="entry-detail-row">
                        <span class="detail-label">Current Usage:</span>
                        <span class="detail-value">${entry.currentUsage || 'N/A'}</span>
                    </div>
                    ${entry.suggestionDetails ? `
                        <div class="entry-detail-row">
                            <span class="detail-label">Suggestions:</span>
                            <span class="detail-value">${entry.suggestionDetails}</span>
                        </div>
                    ` : ''}
                </div>
                ${displayPhotos(entry.photos, `Unused Space - ${entry.submittedByName}`)}
            `;
            
            return card;
        }

        // Initialize dashboard
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Dashboard loaded');
            try {
                await checkAuthorization();
                await loadStatistics();
                await loadWasteEntries();
            } catch (error) {
                console.error('‚ùå Dashboard initialization error:', error);
            }
        });

        // Navbar scroll behavior
        const navbar = document.querySelector('.navbar');
        let lastScrollTop = 0;

        window.addEventListener('scroll', function() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                navbar.classList.add('hidden');
            } else {
                navbar.classList.remove('hidden');
            }
            
            lastScrollTop = scrollTop;
        });
    </script>
</body>
</html>
